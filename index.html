<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ポチポチ修理受付ツール</title>
<style>
  body { font-family: system-ui, -apple-system, Segoe UI, Roboto, "Hiragino Kaku Gothic ProN", "BIZ UDPGothic", sans-serif; margin: 24px; }
  h1 { margin-bottom: 8px; }
  .card { border: 1px solid #ddd; border-radius: 10px; padding: 16px; margin-bottom: 16px; }
  .btn { display: inline-block; padding: 10px 14px; border: 1px solid #ccc; border-radius: 8px; cursor: pointer; margin: 6px 6px 0 0; font-size: 15px; }
  .btn:hover { background: #f5f5f5; }
  .path { font-size: 12px; color: #666; margin-bottom: 8px; }
  .result { background: #f7fff7; border: 1px solid #bde5bd; }
  .note { font-size: 12px; color: #666; margin-top: 8px; }
</style>
</head>
<body>
<h1>ポチポチ修理受付ツール</h1>
<div class="card">
  <div class="path" id="path"></div>
  <div id="content">読み込み中…</div>
  <div style="margin-top:12px">
    <button class="btn" id="backBtn" style="display:none">← ひとつ戻る</button>
    <button class="btn" id="resetBtn">最初から</button>
  </div>
</div>

<script>
const BRANDS = ["NEC","Fujitsu","Lenovo","Surface","Dell","ASUS","Dynabook","MSI","BIO","Mouse Computer"];
const STORE_DISALLOWED = new Set(["Dell","Lenovo","MSI","Mouse Computer"]);
const WARRANTY_ACCEPTED = new Set(["Fujitsu","Dynabook","NEC","Mouse Computer","BIO"]);

const FLOW = { start: "メーカー選択", nodes: {} };
FLOW.nodes["メーカー選択"] = {
  type: "choice",
  question: "パソコンのメーカーを選んでください",
  options: BRANDS.map(b => ({ label: b, next: `${b}_野島保証確認` }))
};

for (const b of BRANDS) {
  FLOW.nodes[`${b}_野島保証確認`] = {
    type: "choice",
    question: `[${b}] 野島の保証に入っていますか？`,
    options: [
      { label: "はい", next: `${b}_延長対応確認` },
      { label: "いいえ", next: STORE_DISALLOWED.has(b) ? `${b}_店頭不可_直送` : `${b}_メーカー保証確認` }
    ]
  };
  FLOW.nodes[`${b}_延長対応確認`] = {
    type: "choice",
    question: `[${b}] 今回の修理内容は「メーカー保証の延長」で対応できそうですか？`,
    options: [
      { label: "はい", next: `${b}_一旦保留` },
      { label: "いいえ", next: `${b}_プレホプラス案内` }
    ]
  };
  FLOW.nodes[`${b}_一旦保留`] = {
    type: "result",
    title: `[${b}] いったん保留`,
    details: ["・延長保証で対応できる可能性があります。","・社内ルール／保証規約を確認のうえ確定してください。"]
  };
  FLOW.nodes[`${b}_プレホプラス案内`] = {
    type: "result",
    title: `[${b}] プレホプラス加入なら店舗受付可能`,
    details: ["・延長保証外ですが、プレホプラス加入で店舗受付可能です。"]
  };
  if (STORE_DISALLOWED.has(b)) {
    FLOW.nodes[`${b}_店頭不可_直送`] = {
      type: "result",
      title: `[${b}] 店頭受付不可：メーカー修理へ案内`,
      details: ["・当店での修理受付不可。","・メーカー公式窓口を案内してください。"]
    };
  } else {
    FLOW.nodes[`${b}_メーカー保証確認`] = {
      type: "choice",
      question: `[${b}] メーカー保証内ですか？`,
      options: [
        { label: "はい", next: WARRANTY_ACCEPTED.has(b) ? `${b}_保証内_受付可` : `${b}_保証内_受付不可_直やり` },
        { label: "いいえ", next: `${b}_保証外_案内` }
      ]
    };
    if (WARRANTY_ACCEPTED.has(b)) {
      FLOW.nodes[`${b}_保証内_受付可`] = {
        type: "result",
        title: `[${b}] 修理受付可能（メーカー保証内）`,
        details: ["・保証書とレシートを確認してください。","・店頭で受付可能です。"]
      };
    }
    if (!WARRANTY_ACCEPTED.has(b)) {
      FLOW.nodes[`${b}_保証内_受付不可_直やり`] = {
        type: "result",
        title: `[${b}] 修理受付不可（メーカー直接対応）`,
        details: ["・保証内ですが当店受付対象外です。","・メーカーと直接やり取りをお願いします。"]
      };
    }
    FLOW.nodes[`${b}_保証外_案内`] = {
      type: "result",
      title: `[${b}] 保証外（有償対応見込み）`,
      details: ["・保証外のため有償対応の可能性があります。","・詳細は社内ルールに従って案内してください。"]
    };
  }
}

const state = { history: [], current: FLOW.start };
function renderPath(){const path=[FLOW.start,...state.history.map(h=>h.choice||h.node)];document.getElementById('path').textContent="進行: "+path.join(" > ");}
function render(){
  renderPath();const node=FLOW.nodes[state.current];const c=document.getElementById('content');c.innerHTML="";
  if(!node){c.textContent="ノードが見つかりません: "+state.current;return;}
  if(node.type==="choice"){
    const h=document.createElement('h2');h.textContent=node.question;c.appendChild(h);
    (node.options||[]).forEach(o=>{const b=document.createElement('button');b.className="btn";b.textContent=o.label;b.onclick=()=>{state.history.push({node:state.current,choice:o.label});state.current=o.next;render();};c.appendChild(b);});
  } else {
    const w=document.createElement('div');w.className="card result";const h=document.createElement('h2');h.textContent=node.title;w.appendChild(h);
    const ul=document.createElement('ul');(node.details||[]).forEach(d=>{const li=document.createElement('li');li.textContent=d;ul.appendChild(li);});w.appendChild(ul);c.appendChild(w);
  }
  document.getElementById('backBtn').style.display=state.history.length?"inline-block":"none";
}
document.getElementById('resetBtn').onclick=()=>{state.history=[];state.current=FLOW.start;render();};
document.getElementById('backBtn').onclick=()=>{if(!state.history.length)return;const last=state.history.pop();state.current=last.node;render();};
render();
</script>
</body>
</html>
